<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Codecademy Middleware</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		/* color: rgb(55, 53, 47); */
		background-color: #0d1117;
		color: #ecf2f8;
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 3px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}

.green {
	color: limegreen;
}

.yellow {
	color: yellow;
}

.brown {
	color: darkorange;
}

.db {
	color: chocolate;
}

.pink {
	color: pink;
}

</style></head><body><article id="fc3438f4-b84c-41a2-81f1-30485523f84e" class="page sans"><header><h1 class="page-title">Codecademy Middleware</h1></header><div class="page-body"><nav id="83ac38f2-3e23-41b0-8af9-0f40604ccbe4" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#78f09db0-94b4-4b9e-bef3-5b137f97e6f9"><code><strong><strong>DRYing Code With Functions</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#994ee85f-c566-4401-96b9-70154d403007"><code><strong><strong>DRYing Routes With </strong></strong></code><mark class="highlight-orange"><code><strong><strong>app.use()</strong></strong></code></mark></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d6dcd8f9-73cb-4073-9651-7e892ef49a48"><code>next();</code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8d9b753a-a086-4ac2-8c12-2023459df239"><code><strong><strong>Route-Level </strong></strong></code><mark class="highlight-orange"><code><strong><strong>app.use()</strong></strong></code></mark></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1b0a9d09-d73f-47a5-abcc-f1cdbb4e1e0f"><strong><strong>- </strong></strong><code><strong><strong>Single Path</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#160c0f4b-7778-4265-901a-39322527fc91">- <code>Multiple Path</code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#54331b16-dd67-4acd-ac36-2cd775e24f3e"><code><strong><strong>Middleware Stacks</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#30ba18c9-0d34-4902-865d-5717df19adab"><code><strong><strong>Open-Source Middleware</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#9ec62cc8-5740-4c43-ae72-2ed44ae7331c"><code><strong><strong>Logging</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f0a7be58-1a63-4178-9bc3-7a907a1b1573"><code><strong><strong>Body Parsing</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d678335f-3cfd-499b-a826-5dcb786a8c43"><code><strong><strong>Error-Handling</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#127e308d-8f2c-4a88-beaa-84a65c2fbffc"><code><strong><strong>Open-Source Middleware</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#18d14762-c907-480c-8fda-f01af21fdb9b"><code>Router Parameters</code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#aba8ae34-fd7c-40fe-9cff-228125bed21e"><code><strong><strong>router.param()</strong></strong></code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d7379716-99cb-426b-add4-eca3afda0396"><code><strong><strong>Merge Parameters</strong></strong></code></a></div></nav><p id="7d9f2efd-b4d5-44e8-8f3e-92832f45b013" class="">การ maintain code ทำให้มันดูแลรักษาได้ง่าย เพราะมันจะอยู่กับเราไปอีกนานแสนนาน ไม่ให้คนอื่นมาด่าเราด้ายยยยว่าเราทำอะไรลงไปตอนนั้น</p><h2 id="78f09db0-94b4-4b9e-bef3-5b137f97e6f9" class=""><code><strong><strong>DRYing Code With Functions</strong></strong></code></h2><p id="6e105f45-413a-4378-9198-c311c7bf4d35" class="">Take a look at the following <mark class="highlight-purple">bad example</mark> code :</p><pre id="587f6d31-3b42-4efb-b232-878efcc5593a" class="code"><code>const addFive = number =&gt; {
  const fiveAdded = number + 5;
  console.log(`Your number plus 5 is ${fiveAdded}`);
}
 
const addTen = number =&gt; {
  const tenAdded = number + 10;
  console.log(`Your number plus 10 is ${tenAdded}`);
}
 
const addTwenty = number =&gt; {
  const twentyAdded = number + 20;
  console.log(`Your number plus 20 is ${twentyAdded}`);
}</code></pre><p id="a74b255a-f7ba-455b-b655-120b4ba39c64" class=""><mark class="highlight-teal">good example</mark></p><pre id="cde2b21a-826d-468c-a752-5bb58623ff11" class="code"><code>const addNumber = (number, addend) =&gt; {
  const numAdded = number + addend;
  console.log(`Your number plus ${addend} is ${numAdded}`);
}</code></pre><p id="9987986c-5194-415f-862f-de1276efdd47" class=""><mark class="highlight-orange">ไม่สร้างฟังก์ชั่นทำงานคล้ายกันซ้ำกันไปมา(duplicate)</mark><mark class="highlight-pink"> </mark> ควรทำแค่อันเดียวโดยใช้การเพิ่ม <code>arguments</code> <mark class="highlight-orange">สามารถนำมา reuse</mark> ได้ ซึ่งจะมีประโยชน์เวลา<mark class="highlight-teal"> maintenance</mark> แก้ไขได้ง่าย โดยแก้แค่จุดเดียว</p><h2 id="994ee85f-c566-4401-96b9-70154d403007" class=""><code><strong><strong>DRYing Routes With </strong></strong></code><mark class="highlight-orange"><code><strong><strong>app.use()</strong></strong></code></mark></h2><pre id="77003e01-edf5-4bcd-a0d2-aabb0769f4d0" class="code"><code>app.use((req, res, next) =&gt; {
  console.log(&#x27;Request received&#x27;);
});</code></pre><ul id="0bc55d50-04e6-43da-88a9-91a0cc13845f" class="bulleted-list"><li style="list-style-type:disc"><strong>Middleware functions สามารถเข้าถึง</strong><ul id="7f06ea6c-cc3e-4ce0-b9cc-46b2b3b90e27" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-pink"><strong>request </strong></mark><strong>object</strong> (<code><strong>req)</strong></code><strong> </strong>สิ่งที่ user/client ส่งมา </li></ul><ul id="99649c60-764f-4c9a-8be2-0d05ad93be77" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-pink"><strong>response </strong></mark><strong>object</strong> (<code><strong>res</strong></code>) สิ่งที่เราใช้ตอบกลับ user กลับ (status-code, data) (ทำเสร็จแล้ว) </li></ul><ul id="c05eb1fb-c39a-4754-bc6d-2657bf3ca632" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-pink"><strong>request-response cycle</strong></mark><strong> </strong>(<code><strong>next</strong></code>) คือ ส่งให้ middleware function ตัวถัดไปที่มาทำงานต่อ</li></ul></li></ul><pre id="27135516-a1a9-4b1a-a61f-bc9942a884c8" class="code"><code>const myRouter (req, res, next) =&gt; {
  //code
	next();
};

app.use(myRouter);
app.use(&#x27;/&#x27;, myRouter); //ทุก path
app.use(&#x27;/user&#x27;, myRouter); //เฉพาะ path user ไรงี้</code></pre><h3 id="d6dcd8f9-73cb-4073-9651-7e892ef49a48" class=""><code>next();</code></h3><pre id="7b174572-250c-4fc6-8d34-e1aa2060cad7" class="code"><code>//เข้าทุก path เลย แต่ตัวอย่างด้านล่าง (Route-Level) จะเข้าตาม path ที่กำหนด
app.use((req, res, next) =&gt; {
  console.log(&quot;A sorcerer approaches!&quot;);
  next();
});
 
//แสดงผล
app.get(&#x27;/magic/:spellname&#x27;, (req, res, next) =&gt; {
  console.log(&quot;The sorcerer is casting a spell!&quot;);
  next();
});
 
//แสดงผล
app.get(&#x27;/magic/:spellname&#x27;, (req, res, next) =&gt; {
  console.log(`The sorcerer has cast ${req.params.spellname}`);
  res.status(200).send();
});

//ไม่แสดงผลเนื่องจาก อันก่อนหน้าไม่ส่ง next(); มา
app.get(&#x27;/magic/:spellname&#x27;, (req, res, next) =&gt; {
  console.log(&quot;The sorcerer is leaving!&quot;);
});
 
// Accessing http://localhost:4001/magic/fireball 
// Console Output:
// &quot;A sorcerer approaches!&quot;
// &quot;The sorcerer is casting a spell!&quot;
// &quot;The sorcerer has cast fireball&quot;</code></pre><h2 id="8d9b753a-a086-4ac2-8c12-2023459df239" class=""><code><strong><strong>Route-Level </strong></strong></code><mark class="highlight-orange"><code><strong><strong>app.use()</strong></strong></code></mark></h2><h3 id="1b0a9d09-d73f-47a5-abcc-f1cdbb4e1e0f" class=""><strong><strong>- </strong></strong><code><strong><strong>Single Path</strong></strong></code></h3><p id="04d11b28-1016-4b9d-9b90-a81b9328db16" class=""><code>app.use([path,] callback [, callback...])</code></p><p id="aa08ba4b-ddbd-45b7-a414-dc7cd5799a7a" class=""><strong>สามารถเลือก specific path</strong> ได้</p><pre id="314ba02f-a123-4540-8049-284185a22bd3" class="code"><code>app.use(&#x27;/beans/:beanName&#x27;, (req, res, next) =&gt; {
  const beanName = req.params.beanName;
  if (!jellybeanBag[beanName]) {
    console.log(&#x27;Response Sent&#x27;);
    return res.status(404).send(&#x27;Bean with that name does not exist&#x27;);
  }
  req.bean = jellybeanBag[beanName];
  req.beanName = beanName;
  next();
});

app.get(&#x27;/beans/:beanName&#x27;, (req, res, next) =&gt; {
  res.send(req.bean);
  console.log(&#x27;Response Sent&#x27;);
});

app.post(&#x27;/beans/:beanName/add&#x27;, (req, res, next) =&gt; {
  let bodyData = &#x27;&#x27;;
  req.on(&#x27;data&#x27;, (data) =&gt; {
    bodyData += data;
  });
});

app.post(&#x27;/beans/:beanName/remove&#x27;, (req, res, next) =&gt; {
  let bodyData = &#x27;&#x27;;
  req.on(&#x27;data&#x27;, (data) =&gt; {
    bodyData += data;
  });
});

app.listen(PORT, () =&gt; {
  console.log(`Server is listening on port ${PORT}`);
});</code></pre><ul id="13b16b9a-1aa8-4b4d-9eda-cc902115406a" class="bulleted-list"><li style="list-style-type:disc">จากตัวอย่าง กำหนด path <code>/beans/:beanName</code> ดังนั้น <code>/beans/:beanName</code><mark class="highlight-orange"><code>/add</code></mark><mark class="highlight-orange"> </mark>กับ <code>/beans/:beanName</code><mark class="highlight-orange"><code>/remove</code></mark> ก็ใช้ได้ เพราะมี<code>/beans/:beanName</code></li></ul><ul id="d864e3c7-a76c-459b-bf79-d33a8ab645f4" class="bulleted-list"><li style="list-style-type:disc"><code>/beans/:beanName</code> คือ beans/string ใดๆ เช่น /beans/almond  /beans/peanut</li></ul><ul id="d3b47b9e-7894-48f1-9a5f-c8dddbc34508" class="bulleted-list"><li style="list-style-type:disc">ถ้าอยากให้ function จบการทำงานให้ใส่ return; ถ้าไม่ใส่ code จะทำงานต่อ</li></ul><h3 id="160c0f4b-7778-4265-901a-39322527fc91" class="">- <code>Multiple Path</code></h3><ul id="560e8cd6-1f9e-4958-89a1-5d1162c9918a" class="bulleted-list"><li style="list-style-type:disc">A string representing a path. <mark class="highlight-blue">match แบบตรงๆ คำต้องเหมือนแบบนี้เป๊ะๆ </mark><mark class="highlight-pink">/beans</mark></li></ul><ul id="eb364e66-c7b5-433c-8f06-c573a639fa43" class="bulleted-list"><li style="list-style-type:disc">A path pattern. <code>/beans/:beanName</code> <mark class="highlight-blue">คือ beans/string ใดๆ เช่น </mark><mark class="highlight-pink">/beans/almond </mark></li></ul><ul id="df37cd8b-3002-4245-932d-acc9d70ebb5a" class="bulleted-list"><li style="list-style-type:disc">A regular expression pattern to match paths. [<mark class="highlight-pink">A-Za-z</mark>]<mark class="highlight-pink">{3}</mark><mark class="highlight-blue"> , a-z ตัวใหญ่หรือเล็กก็ได้ มีความยาว 3 ตัวอักษร</mark></li></ul><ul id="694e26f7-1ce6-4ad2-869f-f74be034d59a" class="bulleted-list"><li style="list-style-type:disc">An array of combinations of any of the above. <mark class="highlight-pink">[&#x27;/beans/&#x27;, &#x27;/beans/:beanName&#x27;]</mark></li></ul><pre id="71414fab-fc74-4901-b754-9cd009e26783" class="code"><code>app.use([&#x27;/beans/&#x27;, &#x27;/beans/:beanName&#x27;], (req, res, next) =&gt; {
  let bodyData = &#x27;&#x27;;
  req.on(&#x27;data&#x27;, (data) =&gt; {
    bodyData += data;
  });
  req.on(&#x27;end&#x27;, () =&gt; {
    if (bodyData) {
      req.body = JSON.parse(bodyData);
    }
    next();
  });
});</code></pre><h2 id="54331b16-dd67-4acd-ac36-2cd775e24f3e" class=""><code><strong><strong>Middleware Stacks</strong></strong></code></h2><p id="670c64ba-9eda-4a7f-9e08-7e1abd5ed562" class="">middleware สามารถใส่ callback function ใน methods เช่น<code>app.use()</code>, <code>app.get()</code>,<code>app.post()</code>,<code> app.put() </code>ได้มากกว่า 1 ตัว </p><pre id="360469f2-bbbd-4465-a6a3-6bb4c1b92056" class="code"><code>const authenticate = (req, res, next) =&gt; {
  ...
};
 
const validateData = (req, res, next) =&gt; {
  ...
};
 
const getSpell = (req, res, next) =&gt; {
  res.status(200).send(getSpellById(req.params.id));
};
 
const createSpell = (req, res, next) =&gt; {
  createSpellFromRequest(req);
  res.status(201).send();
};
 
const updateSpell = (req, res, next) =&gt; {
  updateSpellFromRequest(req);
  res.status(204).send();
}
 
app.get(&#x27;/spells/:id&#x27;, authenticate);
app.get(&#x27;/spells/:id&#x27;, getSpell);
app.get(&#x27;/spells/:id&#x27;, authenticate, getSpell); //รวมร่างงง
app.post(&#x27;/spells&#x27;, authenticate, validateData, createSpell);
app.put(&#x27;/spells/:id&#x27;, authenticate, validateData, updateSpell);</code></pre><p id="c9600750-f4ac-4f7a-bcc2-f2726bee2c28" class=""><mark class="highlight-blue">authenticate </mark>ก็ยังซ้ำเยอะอยู่ แบบนี้ก็ยังไม่ดี ถ้าจะให้ดีก็ไปใข้<code>app.use()</code> แทน</p><h2 id="30ba18c9-0d34-4902-865d-5717df19adab" class=""><code><strong><strong>Open-Source Middleware</strong></strong></code></h2><h3 id="9ec62cc8-5740-4c43-ae72-2ed44ae7331c" class=""><code><strong><strong>Logging</strong></strong></code></h3><p id="578c241e-8aec-4f1c-ada0-82f0d6e12e40" class="">ตัวจดบันทึก</p><p id="f9339e72-ffaa-4a0e-a8c6-a19ab0fc2dc2" class=""><mark class="highlight-teal"><code>morgan </code></mark>คือ middleware สำหรับ log ข้อมูลที่ user request เข้ามาใช้งาน  - kplug</p><p id="e01b2464-3a56-4dd6-8406-76310b434776" class="">an open-source library for logging information about the HTTP request-response cycle in a server application. </p><pre id="9a7f6725-1cff-418b-9d5f-d897cc2bc96d" class="code"><code>const morgan = require(&#x27;morgan&#x27;);

app.use(morgan(&#x27;tiny&#x27;));

app.listen(PORT, () =&gt; {
  console.log(`Response Sent`);
});</code></pre><p id="8d04e7ca-b222-4fa9-9d36-d5c447f3d704" class=""><code>GET /beans/lemon 200 12 - 2.093 ms</code></p><h3 id="f0a7be58-1a63-4178-9bc3-7a907a1b1573" class=""><code><strong><strong>Body Parsing</strong></strong></code></h3><p id="0f64537d-54c3-4cf1-974e-fb8ca7e598e6" class="">ช่วยให้สามารถแยกวิเคราะห์เนื้อหาของ HTTP request เมื่อ client ส่ง request มายัง Express server</p><p id="4a546b1c-a4bf-4135-b47c-d44f0b5e1eef" class="">อำนวยความสะดวกในการแปลงรูปแบบ body ของ http เป็นรูปแบบต่างๆ</p><figure id="7af13d23-5aa7-41dc-8e72-d171b05ebad1"><a href="https://github.com/expressjs/body-parser"><strong>github body-parser</strong></a></p></figure><p id="5b637529-f392-4e7b-9a3f-92ef5e016cb7" class=""><a href="https://expressjs.com/en/resources/middleware/body-parser.html"><strong>body-parser</strong></a></p><pre id="36801578-d8ce-4e6b-8688-65ffd71a9407" class="code"><code>const bodyParser = require(&#x27;body-parser&#x27;);

app.use(bodyParser.json());</code></pre><h3 id="d678335f-3cfd-499b-a826-5dcb786a8c43" class=""><code><strong><strong>Error-Handling</strong></strong></code></h3><p id="6e80d672-824c-425e-bbab-82940fac357d" class="">ตัวจัดการ error ของ express ปกติใช้ try-catch แต่ผลที่ได้จะไม่รู้ว่า error เกิดขึ้นที่ตรงไหนของ code ดังนั้นจึงมี middleware เข้ามาช่วย</p><pre id="0c144d6d-dc38-40a7-8e13-cfd047a9c98c" class="code"><code>const errorHandler = require(&#x27;errorhandler&#x27;)
app.use(errorHandler());

app.use((err, req, res, next) =&gt; {
  console.error(err.stack);
  res.status(500).send(&#x27;Something broke!&#x27;);
});</code></pre><pre id="b8b0658f-3b96-4fdb-8448-359cd6c4ae19" class="code"><code>//ถ้าก้อนนี้ error จะลงไปที่ก้อนข้างล่าง ที่มี err รองรับ
app.post(&#x27;/beans/:beanName/remove&#x27;, (req, res, next) =&gt; {
  const numberOfBeans = Number(req.body.number) || 0;
  if (req.bean.number &lt; numberOfBeans) {
    const error = new Error(&#x27;Not enough beans in the jar to remove!&#x27;)
    error.status = 400;
    return next(error);
  }
  req.bean.number -= numberOfBeans;
  res.send(req.bean);
});

// Add your error handler here:
app.use((err, req, res, next) =&gt; {
  if (!err.status) {
    err.status = 500;
  }
  res.status(err.status).send(err.message);
});</code></pre><p id="d769f336-b551-4767-b01b-b8ca9c89323e" class="">ถ้ามี error หลายแบบ ใช้ if-else ได้</p><pre id="cc1d0234-b873-491b-bd98-9dced32b37d2" class="code"><code>app.use((err, req, res, next) =&gt; {
  if (err.status === 404) {
    res.status(404).send(&#x27;404 Not Found&#x27;)
  } else {
    res.status(500).send(&#x27;Sever is currently down&#x27;)
  }
});</code></pre><h3 id="127e308d-8f2c-4a88-beaa-84a65c2fbffc" class=""><code><strong><strong>Open-Source Middleware</strong></strong></code></h3><p id="104d9959-6588-4e79-bafa-e44864f53288" class=""><a href="https://expressjs.com/en/resources/middleware.html">express middleware</a></p><table id="c1a613c0-e696-47f0-90c5-780b5ba0397a" class="simple-table"><thead class="simple-table-header"><tr id="73d9d380-ef69-470c-bc20-9935ad573e39"><th id=":\HE" class="block-color-pink simple-table-header" style="width:349px">Middleware module</th><th id="fjzQ" class="block-color-pink simple-table-header" style="width:349px">Description</th></tr></thead><tbody><tr id="8f97708e-8cc0-4f2c-b97a-50f3801febcc"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/cors.html">cors</a></td><td id="fjzQ" class="" style="width:349px">ทำให้ api ทำงานไวขึ้น เว็บไวขึ้น</td></tr><tr id="4c5e33ac-597d-4189-8bea-15594e4ea293"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/cookie-session.html">cookie-session</a></td><td id="fjzQ" class="" style="width:349px">used for session management using cookies</td></tr><tr id="2a0a73ac-f718-4a5f-84d9-22d17609c8a1"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/cookie-parser.html">cookie-parser</a></td><td id="fjzQ" class="" style="width:349px">Used to parse cookies in HTTP requests</td></tr><tr id="fedb7d9d-b945-4606-b5c3-1be7a31f92d5"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/body-parser.html">body-parser</a></td><td id="fjzQ" class="" style="width:349px">Parse HTTP request body. See also: <a href="https://github.com/raynos/body">body</a>, <a href="https://github.com/visionmedia/co-body">co-body</a>, and <a href="https://github.com/stream-utils/raw-body">raw-body</a>.</td></tr><tr id="70afcd00-0f52-424f-ae47-6361d204c6d3"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/morgan.html">morgan</a></td><td id="fjzQ" class="" style="width:349px">HTTP request logger.</td></tr><tr id="9e426e92-4cb0-48e9-b19a-7891b57c6b99"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/compression.html">compression</a></td><td id="fjzQ" class="" style="width:349px">Compress HTTP responses.</td></tr><tr id="019731fa-617c-4c83-a784-0a2959a5fc11"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/resources/middleware/serve-static.html">serve-static</a></td><td id="fjzQ" class="" style="width:349px">Serve static files.</td></tr><tr id="09960bca-b974-4613-9f21-4d1569cbb0d4"><td id=":\HE" class="" style="width:349px"><a href="https://github.com/helmetjs/helmet">helmet</a></td><td id="fjzQ" class="" style="width:349px">Used to add security-related HTTP headers to responses</td></tr><tr id="d99cc35c-5507-4e57-b73a-9acc145933bd"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/en/resources/middleware/session.html">express-session</a></td><td id="fjzQ" class="" style="width:349px">Used to manage session data in an Express application</td></tr><tr id="be24c588-c0d8-4dac-ab5b-0ff0b6aeb36f"><td id=":\HE" class="" style="width:349px"><a href="https://github.com/jaredhanson/passport">passport</a></td><td id="fjzQ" class="" style="width:349px">Used to handle user authentication in an Express application</td></tr><tr id="15847d51-4183-45b1-976e-48ec32d99a45"><td id=":\HE" class="" style="width:349px"><a href="https://expressjs.com/en/resources/middleware/multer.html">multer</a></td><td id="fjzQ" class="" style="width:349px">Used to handle file uploads in an Express application</td></tr></tbody></table><h2 id="18d14762-c907-480c-8fda-f01af21fdb9b" class=""><code>Router Parameters</code></h2><h3 id="aba8ae34-fd7c-40fe-9cff-228125bed21e" class=""><code><strong><strong>router.param()</strong></strong></code></h3><p id="0f00214e-63df-4f6a-88fd-c4e83faa7cbe" class="">จะเช็คว่า routes ไหนมีการ input param ชื่อนั้นๆมาใช้บ้าง จะทำให้ function ใน route.param ทำงานก่อนจะเริ่มทำงาน routes นั้น เหมือนเป็น middleware อีกแบบหนึ่ง - kplug</p><pre id="5a6393cf-6e55-4f74-9e78-637b7a8d589e" class="code"><code>app.param(&#x27;spiceId&#x27;, (req, res, next, id) =&gt; {
  const spiceId = Number(id);
  const spiceIndex = spiceRack.findIndex(spice =&gt; spice.id === spiceId);
  
  if (spiceIndex !== -1){
    req.spiceIndex = spiceIndex;
    next();
  } else {
    res.sendStatus(404);
  }
})

app.get(&#x27;/spices/&#x27;, (req, res, next) =&gt; {
  res.send(spiceRack);
});

//จะเรียกใช้บรรทัดนี้ก่อน เพราะ specific spiceId
app.get(&#x27;/spices/:spiceId&#x27;, (req, res, next) =&gt; {
  res.send(spiceRack[req.spiceIndex]);
});</code></pre><pre id="c6a18e40-dd64-4a32-a541-53f8c62fc701" class="code"><code>router.param(&#x27;userId&#x27;, (req, res, next, id) =&gt; {
  req.user = user;
  next();
});

app.get(&#x27;/users/:userId&#x27;, (req, res) =&gt; {
  console.log(req.user);
});</code></pre><h3 id="d7379716-99cb-426b-add4-eca3afda0396" class=""><code><strong><strong>Merge Parameters</strong></strong></code></h3><p id="f58cea6f-7c39-4083-8d3b-0cee3b874d60" class="">ถ้าต้องการใช้ req.params แบบข้ามไฟล์ หรือ ระดับ router คือ ต้องการดึง params จาก app มาใช้ใน router ก็ต้องมีการเรียกใช้งาน merge.param(); ใน router ด้วย - kplug</p><pre id="ae81ee5d-a88b-4d1b-aea3-b7cf47d1fc97" class="code"><code>const router = require(&#x27;express&#x27;).Router({ mergeParams: true });

router.get(&#x27;/:spiceId&#x27;, (req, res, next) =&gt; {
  const spiceId = Number(req.params.id);
  const spiceIndex = spices.findIndex(spice =&gt; spice.id === spiceId);
  if (spiceIndex !== -1) {
    res.send(spices[spiceIndex]);
  } else {
    res.status(404).send(&#x27;Spice not found.&#x27;);
  }
});</code></pre></div></article></body></html>